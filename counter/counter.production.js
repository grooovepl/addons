(()=>{var e={713:e=>{e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},355:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ITEM_RANKS=t.NPC_RANKS=t.COUNTER_LOOTS_RESOURCE=t.COUNTER_KILLS_RESOURCE=t.ADDON_VERSION=t.CSS_HOST=t.API_URL=void 0;var o=r(800);const a=__API__URL;t.API_URL=a,t.CSS_HOST="https://siema.pl/addons/counter/style.css",t.ADDON_VERSION="1.0.5",t.COUNTER_KILLS_RESOURCE="/kills",t.COUNTER_LOOTS_RESOURCE="/loots",t.NPC_RANKS={NORMAL:{type:0,label:"normal"},ELITE:{type:1,label:"elite"},ELITE2:{type:2,label:"elite II"},ELITE3:{type:3,label:"elite III"},HEROS:{type:4,label:"heros"},TITAN:{type:5,label:"titan"},COLOSSUS:{type:6,label:"colossus"}};const s={NORMAL:{type:0,label:o.ItemRankLabels.normal},UNIQUE:{type:1,label:o.ItemRankLabels.unique},HEROIC:{type:2,label:o.ItemRankLabels.heroic},LEGENDARY:{type:3,label:o.ItemRankLabels.legendary}};t.ITEM_RANKS=s},369:(e,t,r)=>{"use strict";var o=r(318);Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;var a=o(r(713));t.EventEmitter=class{constructor(){(0,a.default)(this,"subscribers",void 0),this.subscribers=new Map}on(e,t){return this.subscribe(e,t),this}emit(e,t){this.getSubscribers(e).forEach((e=>e.call(null,t)))}getSubscribers(e){return this.subscribers.get(e)||[]}subscribe(e,t){const r=[...this.getSubscribers(e),t];return this.subscribers.set(e,r),this}unsubscribe(e,t){const r=this.getSubscribers(e).filter((e=>e!==t));return this.subscribers.set(e,r),this}unsubscribeAll(e){return this.subscribers.delete(e),this}}},925:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EVENTS=t.FRAMEWORK_VERSION=void 0,t.FRAMEWORK_VERSION="1.0.0",t.EVENTS={RAW_RESPONSE:"RAW_RESPONSE",BATTLE_START:"BATTLE_START",BATTLE_LOGS:"BATTLE_LOGS",BATTLE_LOG_ITEM:"BATTLE_LOG_ITEM",NEW_FIGHTER:"NEW_FIGHTER",NEW_FIGHTERS:"NEW_FIGHTERS",FIGHTER_DATA_UPDATE:"FIGHTER_DATA_UPDATE",FIGHTERS_DATA_UPDATE:"FIGHTERS_DATA_UPDATE",FIGHTER_KILLED:"FIGHTER_KILLED",BATTLE_END:"BATTLE_END",LOOT:"LOOT",LOOTS:"LOOTS",LOOTS_SEND:"LOOTS_SEND",CHAT_MESSAGE:"CHAT_MESSAGE",NPC_REMOVE_FROM_MAP:"NPC_REMOVE_FROM_MAP",NEW_NPC_ON_MAP:"NEW_NPC_ON_MAP",DIALOG_NPC_KILL:"DIALOG_NPC_KILL",DIALOG_NPC_LOOT:"DIALOG_NPC_LOOT",NEW_PLAYERS_ON_MAP:"NEW_PLAYERS_ON_MAP"}},135:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dialogNpcs=void 0;var o=r(355);const a=[{nick:"Marlloth Malignitas",lvl:214,rank:2,treatAsKill:!1,icon:"/obrazki/npc/pot/marlloth.gif",items:[{name:"Odłamany pajęczy róg",type:o.ITEM_RANKS.UNIQUE},{name:"Pajęcze strzały zimna",type:o.ITEM_RANKS.UNIQUE},{name:"Pajęcze strzały zniszczenia",type:o.ITEM_RANKS.UNIQUE},{name:"Rękawice zwinności",type:o.ITEM_RANKS.UNIQUE},{name:"Życiodajny pierścień zagłady",type:o.ITEM_RANKS.UNIQUE},{name:"Pierścień szybkości fanatyka",type:o.ITEM_RANKS.UNIQUE},{name:"Pajęczy czerep utraconej woli",type:o.ITEM_RANKS.HEROIC},{name:"Spektrum błyskawicy",type:o.ITEM_RANKS.HEROIC},{name:"Siekacz Marlloth",type:o.ITEM_RANKS.HEROIC},{name:"Potężny wytrzewiacz",type:o.ITEM_RANKS.HEROIC},{name:"Kusza drowiego zabójcy",type:o.ITEM_RANKS.HEROIC},{name:"Łuk chłodnego wyznawcy",type:o.ITEM_RANKS.HEROIC},{name:"Rytualny wykrawacz serc",type:o.ITEM_RANKS.HEROIC},{name:"Mroczne wsparcie",type:o.ITEM_RANKS.HEROIC},{name:"Pajęczy hełm czciciela Marlloth",type:o.ITEM_RANKS.HEROIC},{name:"Rękawice pajęczej sieci",type:o.ITEM_RANKS.HEROIC},{name:"Klejnot zainfekowanych sztolni",type:o.ITEM_RANKS.HEROIC},{name:"Buty maniakalnego czciciela",type:o.ITEM_RANKS.LEGENDARY},{name:"Buty adepta pajęczej magii",type:o.ITEM_RANKS.LEGENDARY},{name:"Buty uwikłanego piewcy",type:o.ITEM_RANKS.LEGENDARY}]},{nick:"Rycerz z za małym mieczem",lvl:217,rank:2,icon:"/obrazki/npc/tru/pajeczy16.gif",treatAsKill:!1,items:[{name:"Szmaragdowa obroża",type:o.ITEM_RANKS.UNIQUE},{name:"Lekka osłona schwytanego",type:o.ITEM_RANKS.HEROIC},{name:"Okucie śmiałka",type:o.ITEM_RANKS.HEROIC},{name:"Czarny rycerski kaftan",type:o.ITEM_RANKS.HEROIC},{name:"Dies Irae",type:o.ITEM_RANKS.HEROIC},{name:"Laska władcy huraganów",type:o.ITEM_RANKS.HEROIC},{name:"Mocarny falchion",type:o.ITEM_RANKS.HEROIC},{name:"Anielski miecz światłości",type:o.ITEM_RANKS.HEROIC},{name:"Rękawice nienawiści",type:o.ITEM_RANKS.HEROIC},{name:"Ostrze zniszczenia",type:o.ITEM_RANKS.HEROIC},{name:"Mechaniczne rękawice goblinów",type:o.ITEM_RANKS.HEROIC},{name:"Łuk gromowładcy",type:o.ITEM_RANKS.HEROIC},{name:"Łuk łowcy pająków",type:o.ITEM_RANKS.HEROIC},{name:"Pajęcza ozdoba",type:o.ITEM_RANKS.LEGENDARY}]},{nick:"Młody smok",lvl:282,icon:"/obrazki/npc/pot/smokbarb.gif",treatAsKill:!1,rank:4,items:[{name:"Lamia shaiharrudzka",type:o.ITEM_RANKS.UNIQUE},{name:"Lanca Shaiharrudzkich jeźdźców",type:o.ITEM_RANKS.UNIQUE},{name:"Dech smoka",type:o.ITEM_RANKS.UNIQUE},{name:"Strzały z krwią pustynnego czerwia",type:o.ITEM_RANKS.UNIQUE},{name:"Rozbijacz zastępów",type:o.ITEM_RANKS.UNIQUE},{name:"Piłomiecz Shaiharrudzkich piechociarzy",type:o.ITEM_RANKS.HEROIC},{name:"Złota trująca lamia",type:o.ITEM_RANKS.HEROIC},{name:"Miotacz gniewu smoczego boga",type:o.ITEM_RANKS.HEROIC},{name:"Złotomiot wernoradzkiego najeźdźcy",type:o.ITEM_RANKS.HEROIC},{name:"Miotacz Legionu",type:o.ITEM_RANKS.HEROIC},{name:"Tarcza pustynnego słońca",type:o.ITEM_RANKS.HEROIC},{name:"Młot gniewu Hebrehotha",type:o.ITEM_RANKS.HEROIC},{name:"Ametystowe oko arcykapłana",type:o.ITEM_RANKS.LEGENDARY}]},{nick:"Złoże",lvl:0,rank:1,icon:"/obrazki/itemy/zlo/roz-diamenty.gif",treatAsKill:!0,items:[{name:"Bryłki żelaza",type:o.ITEM_RANKS.UNIQUE},{name:"Srebro rodzime",type:o.ITEM_RANKS.UNIQUE},{name:"Samorodek złota",type:o.ITEM_RANKS.UNIQUE},{name:"Bryłki złota",type:o.ITEM_RANKS.HEROIC},{name:"Samorodek platyny",type:o.ITEM_RANKS.HEROIC},{name:"Diamentowe okruchy",type:o.ITEM_RANKS.HEROIC},{name:"Nieoczyszczony diament",type:o.ITEM_RANKS.LEGENDARY}]}];t.dialogNpcs=a},117:(e,t,r)=>{"use strict";var o=r(318);Object.defineProperty(t,"__esModule",{value:!0}),t.GrooveFramework=void 0;var a=o(r(713)),s=r(369),i=r(461),n=r(135),l=r(925);class c extends s.EventEmitter{constructor(e=window,t){super(),(0,a.default)(this,"chatQueue",[]),(0,a.default)(this,"isBattle",!1),(0,a.default)(this,"currentBattleUniqueId",""),(0,a.default)(this,"targetWindow",void 0),this.targetWindow=e,t&&this.connect()}pushChatMessage(e){this.chatQueue.push(e)}injectChatMessages(e){let t=1,r={...e,c:e.c||{}},o=Object.keys(r.c).length;for(;this.chatQueue.length;){const a={...this.chatQueue.shift(),ts:e.ev+t};r={...r,c:{...r.c,[o]:a}},o+=1,t+=1}return r}searchForBattleLogItems(e,t){const r=e.substring(8),o=": zdobyto ",a=r.includes(o)?o:": looted ",[s,i]=r.split(a);if(!i)return;const n=i.split(", ");this.emit(l.EVENTS.BATTLE_LOG_ITEM,{items:n,npcName:s,battleId:this.currentBattleUniqueId,rawResponse:t})}generateBattleUniqueId(){this.currentBattleUniqueId=btoa(`${Date.now()}`).substring(0,15)}challenge(e){this.emit(l.EVENTS.RAW_RESPONSE,{rawResponse:e}),(0,i.isObject)(e.f)&&e.f&&this.handleBattle(e.f,e),e.item&&e.loot&&(0,i.isObject)(e.item)&&(0,i.isObject)(e.loot)&&this.handleItems(e.item,e.loot,e),e.loot&&(0,i.isObject)(e.loot)&&this.handleLoot(e.loot,e),e.c&&(0,i.isObject)(e.c)&&this.handleChatMessages(e.c,e),e.npc&&(0,i.isObject)(e.npc)&&this.handleNpcs(e.npc,e),e.other&&(0,i.isObject)(e.other)&&this.handleOtherPlayers(e.other,e)}handleBattle(e,t){if(e.init&&(this.isBattle=!0,this.generateBattleUniqueId(),this.emit(l.EVENTS.BATTLE_START,{battleId:this.currentBattleUniqueId,rawResponse:t})),(0,i.isObject)(e.m)&&e.m){const r=e.m.reduce(((r,o,a)=>{if((0,i.isObject)(e.mi)&&e.mi){o.startsWith("0;0;txt=")&&this.searchForBattleLogItems(o,t);const s=Number(e.mi[a]);return r.set(s,o)}return r}),new Map);this.emit(l.EVENTS.BATTLE_LOGS,{logs:r,battleId:this.currentBattleUniqueId,rawResponse:t})}const r=new Map,o=new Map;e.w&&(0,i.isObject)(e.w)&&(0,i.toMap)(e.w).forEach(((e,a)=>{const s=Number(a);e.name?(r.set(s,e),this.emit(l.EVENTS.NEW_FIGHTER,{fighter:e,fighterId:s,battleId:this.currentBattleUniqueId,rawResponse:t})):(o.set(s,e),this.emit(l.EVENTS.FIGHTER_DATA_UPDATE,{fighter:e,fighterId:a,battleId:this.currentBattleUniqueId,rawResponse:t}),0===e.hpp&&this.emit(l.EVENTS.FIGHTER_KILLED,{fighter:e,fighterId:a,battleId:this.currentBattleUniqueId,rawResponse:t}))})),r.size&&this.emit(l.EVENTS.NEW_FIGHTERS,{fighters:r,battleId:this.currentBattleUniqueId,rawResponse:t}),o.size&&this.emit(l.EVENTS.FIGHTERS_DATA_UPDATE,{fighters:o,battleId:this.currentBattleUniqueId,rawResponse:t}),this.isBattle&&-1===e.move&&(this.isBattle=!1,setTimeout((()=>this.emit(l.EVENTS.BATTLE_END,{battle:e,battleId:this.currentBattleUniqueId,rawResponse:t})),0))}handleItems(e,t,r){let o=[];(0,i.toArray)(e).forEach((e=>{if("l"===e.loc||"k"===e.loc){if("dialog"===t.source&&this.lookupForDialogNpcItems(e,t,r))return;this.emit(l.EVENTS.LOOT,{item:e,lootDetails:t,rawResponse:r}),o=[...o,e]}})),o.length&&this.emit(l.EVENTS.LOOTS,{items:o,lootDetails:t,rawResponse:r})}handleLoot(e,t){(e.states||e.timer||e.init)&&this.emit(l.EVENTS.LOOTS_SEND,{rawResponse:t})}handleChatMessages(e,t){(0,i.toMap)(e).forEach((e=>{this.emit(l.EVENTS.CHAT_MESSAGE,{chatMessage:e,rawResponse:t})}))}handleNpcs(e,t){(0,i.toMap)(e).forEach(((e,r)=>{e.del?this.emit(l.EVENTS.NPC_REMOVE_FROM_MAP,{npcId:r,rawResponse:t}):e.nick&&this.emit(l.EVENTS.NEW_NPC_ON_MAP,{npcData:e,rawResponse:t})}))}handleOtherPlayers(e,t){let r=[];(0,i.toMap)(e).forEach(((e,t)=>{e.nick&&(r=[...r,{...e,id:Number(t)}])})),r.length&&this.emit(l.EVENTS.NEW_PLAYERS_ON_MAP,{newPlayers:r,rawResponse:t})}lookupForDialogNpcItems(e,t,r){const o=e.name||"",a=n.dialogNpcs.find((e=>e.items.some((e=>e.name===o))));return!!a&&(a.treatAsKill&&this.emit(l.EVENTS.DIALOG_NPC_KILL,{npc:a,rawResponse:r}),this.emit(l.EVENTS.DIALOG_NPC_LOOT,{npc:a,lootDetails:t,item:e,rawResponse:r}),!0)}connect(){const e=this,{$:t}=this.targetWindow,r=t.ajax;t.ajax=function(o,a){const s="string"==typeof o?a||{}:o,n="string"==typeof o?o:s.url;if("object"!=typeof s||"string"!=typeof n||!n.startsWith("/engine"))return r.call(t,o,a);const l=s.success;return s.success=function(r,o,a){if(!(0,i.isObject)(r))return l instanceof Function?l.call(t,r,o,a):void 0;let s=r;const{chatQueue:n}=e;r.ev&&"ok"===r.e&&n.length&&(s=e.injectChatMessages(r));const c=["e","ev","h","event_done","notices","js","matchmaking_state"];Object.keys(s).every((e=>c.includes(e)))||e.challenge(s),l instanceof Function&&l.call(t,s,o,a)},r.call(t,o,a)}}}t.GrooveFramework=c},477:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"EVENTS",{enumerable:!0,get:function(){return o.EVENTS}}),Object.defineProperty(t,"GrooveFramework",{enumerable:!0,get:function(){return a.GrooveFramework}}),Object.defineProperty(t,"dialogNpcs",{enumerable:!0,get:function(){return s.dialogNpcs}}),t.initFramework=void 0;var o=r(925),a=r(117),s=r(135);t.initFramework=(e=window,t)=>{const r=`GAFramework v${o.FRAMEWORK_VERSION}`;return e.GAServices=e.GAServices||new Map,e.GAServices.get(r)||e.GAServices.set(r,new a.GrooveFramework(e,t)),e.GAServices.get(r)}},15:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LocalStorageService",{enumerable:!0,get:function(){return o.LocalStorageService}}),Object.defineProperty(t,"LocalStorageServiceExtended",{enumerable:!0,get:function(){return a.LocalStorageServiceExtended}});var o=r(754),a=r(392)},754:(e,t,r)=>{"use strict";var o=r(318);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageService=void 0;var a=o(r(713)),s=r(424),i=r(48);class n{constructor(e){(0,a.default)(this,"mainKey",void 0),(0,a.default)(this,"store",{}),(0,a.default)(this,"logger",new s.Logger("LocalStorageService")),(0,a.default)(this,"isLocalStorageAvailable",n.isLocalStorageAvailable()),this.mainKey=e,this.recreateStore()}set(e,t){const r=(0,i.getValidationError)(t);r?this.logger.log(`set(${e}): ${r}`):(this.store[e]=t,this.save())}get(e){return this.store[e]||null}remove(e){const{[e]:t,...r}=this.store;this.replaceStore(r)}replaceStore(e){this.store=e,this.save()}prepareDataForSave(){try{return JSON.stringify(this.store)}catch(e){return this.logger.log(`prepareDataForSave(): ${e}`),"{}"}}save(){this.isLocalStorageAvailable&&localStorage.setItem(this.mainKey,this.prepareDataForSave())}recreateStore(){this.isLocalStorageAvailable?this.store=this.getSavedLocalStorageData():this.logger.log("localStorage is disabled or unavailable")}getSavedLocalStorageData(){const e={},t=window.localStorage;try{const r=t.getItem(this.mainKey);return r?JSON.parse(r):e}catch(t){return this.logger.log(`getSavedLocalStorageData(): ${t}`),e}}static isLocalStorageAvailable(){const e=window.localStorage,t="LSTestKey",r="LSTestValue";try{if(e.setItem(t,r),e.getItem(t)===r)return localStorage.removeItem(t),!0}catch(e){return!1}return!1}}t.LocalStorageService=n},392:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageServiceExtended=void 0;var o=r(754);class a extends o.LocalStorageService{constructor(e){super(e)}add(e,t){const r=this.get(e);r?Array.isArray(r)?this.set(e,[...r,t]):this.logger.log(`add(${e}): target is not an array`):this.set(e,[t])}subtractEvery(e,t){const r=this.get(t);if(!r)return void this.logger.log(`subtract(${e}, ${t}): target does not exist`);if(!Array.isArray(r))return void this.logger.log(`subtract(${e}, ${t}): target is not an array`);const o=r.filter((t=>JSON.stringify(t)!==JSON.stringify(e)));0!==o.length?this.set(t,o):this.remove(t)}removeKeysByPattern(e){Object.keys(this.store).forEach((t=>{t.startsWith(e)&&this.remove(t)}))}}t.LocalStorageServiceExtended=a},48:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValidationError=void 0,t.getValidationError=e=>{switch(typeof e){case"string":case"number":case"boolean":return null;case"object":if(Array.isArray(e))return e.filter(Boolean).length===e.length?null:"array has falsy values"}return`wrong value type (${e}, ${typeof e})`}},424:(e,t,r)=>{"use strict";var o=r(318);Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.emitter=t.events=void 0;var a=o(r(713)),s=r(369);const i={LOG:"LOG",ERROR:"ERROR"};t.events=i;const n=new s.EventEmitter;t.emitter=n,t.Logger=class{constructor(e){(0,a.default)(this,"key",void 0),this.key=`GA->${e}`}newError(e){const t=this.buildMessage(e);return n.emit(i.ERROR,t),new Error(t)}log(e){const t=this.buildMessage(e);console.log(t),n.emit(i.LOG,t)}buildMessage(e){return`${this.key}: ${e}`}}},456:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWorldName=t.getGameMap=t.getNpcById=t.isSI=void 0;const{_g:r,g:o,map:a,Engine:s}=window,i=()=>void 0!==r&&void 0!==o&&void 0!==a;t.isSI=i,t.getNpcById=e=>{if(!e)return;var t;if(i())return null==o||null===(t=o.npc)||void 0===t?void 0:t[e];const r=s.npcs.getById(e)||s.npcs.getById(`${e}`);return r?r.d:null},t.getGameMap=()=>i()?a:null==s?void 0:s.map,t.getWorldName=()=>i()?null==o?void 0:o.worldname:null==s?void 0:s.worldName},997:(e,t,r)=>{"use strict";var o=r(318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(r(713)),s=r(477),i=r(627),n=r(168),l=r(355);t.default=class{constructor(e){(0,a.default)(this,"targetWindow",void 0),(0,a.default)(this,"model",new n.AddonModel),(0,a.default)(this,"view",new i.AddonView),(0,a.default)(this,"framework",void 0),this.targetWindow=e,this.framework=(0,s.initFramework)(this.targetWindow,!0),this.subscribeFrameworkEvents(),this.subscribeModelEvents(),this.subscribeViewEvents(),this.subscribeModelEvents()}subscribeModelEvents(){this.model.on(n.events.A,(()=>null))}subscribeViewEvents(){this.view.on(i.events.LAUNCHER_CLICKED,(()=>({})))}subscribeFrameworkEvents(){this.framework.on(s.EVENTS.BATTLE_START,(e=>this.model.handleBattleStart(e))),this.framework.on(s.EVENTS.LOOTS,(e=>this.model.handleLoots(e))),this.framework.on(s.EVENTS.NEW_FIGHTERS,(e=>this.model.handleFighters(e))),this.framework.on(s.EVENTS.FIGHTER_KILLED,(e=>this.model.handleFighterKill(e))),this.framework.on(s.EVENTS.BATTLE_LOG_ITEM,(e=>this.model.handleBattleLogItem(e))),this.framework.on(s.EVENTS.DIALOG_NPC_KILL,(e=>this.model.handleDialogNpcKill(e))),this.framework.on(s.EVENTS.DIALOG_NPC_LOOT,(e=>this.model.handleDialogNpcLoot(e)))}init(){this.view.loadStyles(this.targetWindow),this.view.render(l.ADDON_VERSION)}}},168:(e,t,r)=>{"use strict";var o=r(318);Object.defineProperty(t,"__esModule",{value:!0}),t.AddonModel=t.events=void 0;var a=o(r(713)),s=r(369),i=r(686),n=r(678),l=o(r(212)),c=r(676),u=r(355),d=r(456),E=r(800);const h="bosses-for-kills",m="bosses-for-loots",S="item-names-from-battle-log";t.events={A:"A"};class g extends s.EventEmitter{constructor(...e){super(...e),(0,a.default)(this,"isBattleRefreshed",!1)}handleDialogNpcKill({npc:e}){const{treatAsKill:t,items:r,...o}=e;t&&this.sendApiRequest(u.COUNTER_KILLS_RESOURCE,{npc:o})}handleDialogNpcLoot({npc:e,item:t}){const{treatAsKill:r,items:o,...a}=e,s=(0,c.mapItems)([t]),i=this.countItemTypes(s);this.sendApiRequest(u.COUNTER_LOOTS_RESOURCE,{npc:a,loots:i})}handleBattleStart(e){console.log("BATTLE_STARTED"),this.isBattleRefreshed=(0,c.wasPageRefreshDuringBattle)(e.rawResponse),console.log("WAS PAGE REFRESH DURING BATTLE",this.isBattleRefreshed),this.resetLocalStorageItemsFromBattleLog(),this.isBattleRefreshed||this.resetLocalStorage()}handleFighters({fighters:e}){console.log("NEW_FIGHTERS",e);const t=(0,c.getNpcsFromFightersMap)(e);console.log("NPCS ONLY",t);const r=(0,c.searchForBosses)(t);console.log("BOSSES",r);const o=[];this.isBattleRefreshed&&i.localStorageService.get(h)||(this.resetLocalStorage(),r.forEach((e=>{const t=e.nick;this.saveBossAsLaterKillProvider(e),o.includes(t)||(o.push(t),this.saveBossAsLaterLootProvider(e))})))}handleBattleLogItem({npcName:e,items:t}){this.getBossesFromlocalStorage(h).find((t=>t.nick===e))&&t.forEach((e=>{i.localStorageService.add(S,e)}))}handleFighterKill({fighterId:e}){console.log("FIGHTER KILLED",e);const t=Math.abs(Number(e)),r=this.getBossFromLocalStorageKillProviders(t),o=(0,d.getNpcById)(t);if(!o)return void l.default.log(`handleFighterKill(${e}): no such NPC`);const a=(0,c.getNpcRank)(o,(0,d.getGameMap)());if(!r)return void(o&&(0,c.isNpcWorthCounting)(a)&&(l.default.log(`handleFighterKill(${o.nick}): it was not saved in LS earlier`),this.resetLocalStorage()));const{id:s,...i}=r;this.sendApiRequest(u.COUNTER_KILLS_RESOURCE,{npc:i}),this.removeBossFromLocalStorageKillProviders(t)}handleLoots({items:e}){console.log("LOOTS",e);const t=(0,c.mapItems)(e).filter(c.isItemGoodEnough);console.log("GOOD ENOUGH ITEMS",t),t.length&&this.areAllItemsInLocalStorage(t)&&(this.applyLootsToAllBeatenBosses(t),this.resetLocalStorageItemsFromBattleLog())}sendApiRequest(e,t){n.httpService.post(e,{data:JSON.stringify({...t,mapName:(0,d.getGameMap)().name,worldName:(0,d.getWorldName)()})}).catch((t=>l.default.log(`sendApiRequest(${e}): ${t}`)))}applyLootsToAllBeatenBosses(e){const t=this.getBossesFromlocalStorage(m),r=this.countItemTypes(e);t.forEach((e=>{const{id:t,...o}=e;this.sendApiRequest(u.COUNTER_LOOTS_RESOURCE,{npc:o,loots:r}),i.localStorageService.subtractEvery(e,m)}))}countItemTypes(e){return e.reduce(((e,t)=>({...e,[t.rank.label]:e[t.rank.label]+1})),{[E.ItemRankLabels.unique]:0,[E.ItemRankLabels.heroic]:0,[E.ItemRankLabels.legendary]:0,[E.ItemRankLabels.normal]:0})}areAllItemsInLocalStorage(e){let t,r=i.localStorageService.get(S);if(!r||!r.length)return!1;const o=[...e];for(;t=o.shift();){const{name:e}=t,o=r.indexOf(e);if(-1===o)return!1;r=r.slice(o,1)}return!0}saveBossAsLaterLootProvider(e){i.localStorageService.add(m,e)}saveBossAsLaterKillProvider(e){i.localStorageService.add(h,e)}resetLocalStorageItemsFromBattleLog(){i.localStorageService.remove(S)}resetLocalStorageKillsProviders(){i.localStorageService.remove(h)}resetLocalStorageLootsProviders(){i.localStorageService.remove(m)}resetLocalStorage(){this.resetLocalStorageKillsProviders(),this.resetLocalStorageLootsProviders()}removeBossFromLocalStorageKillProviders(e){const t=this.getBossesFromlocalStorage(h).find((t=>t.id===e));t&&i.localStorageService.subtractEvery(t,h)}getBossesFromlocalStorage(e){return i.localStorageService.get(e)||[]}getBossFromLocalStorageKillProviders(e){return this.getBossesFromlocalStorage(h).find((t=>t.id===e))}}t.AddonModel=g},66:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addon=t.launcher=void 0,t.launcher=e=>`<div id="ga-counter-addon-launcher" tip="Licznik Ubić by Groove Armada v${e}">L</div>`,t.addon=()=>""},627:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddonView=t.events=void 0;var o=r(369),a=r(66),s=r(355);t.events={LAUNCHER_CLICKED:"LAUNCHER_CLICKED"};class i extends o.EventEmitter{render(e){return(0,a.launcher)(e)+(0,a.addon)()}loadStyles(e){const t=e.document.createElement("link");t.href=s.CSS_HOST,t.rel="stylesheet",t.type="text/css",e.document.head.appendChild(t)}}t.AddonView=i},896:(e,t,r)=>{"use strict";var o=r(318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(r(997)).default;t.default=a},678:(e,t,r)=>{"use strict";var o=r(318);Object.defineProperty(t,"__esModule",{value:!0}),t.httpService=void 0;var a=o(r(713)),s=r(355);const i=new class{constructor(){(0,a.default)(this,"url",s.API_URL)}post(e,t){return new Promise(((r,o)=>{window.$.ajax({url:this.url+e,type:"post",timeout:2e3,async:!0,data:t,success:e=>r(e),error:(e,t,r)=>o(r)})}))}};t.httpService=i},686:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.localStorageService=void 0;const o=new(r(15).LocalStorageServiceExtended)("ga-counter-addon");t.localStorageService=o},212:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=new(r(424).Logger)("counter-addon");t.default=o},514:(e,t,r)=>{"use strict";r(800)},209:()=>{},800:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(514);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=r(57);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var s=r(285);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var i=r(284);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var n=r(209);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))}))},57:()=>{},285:(e,t)=>{"use strict";let r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.ItemRankLabels=t.Profession=void 0,t.Profession=r,function(e){e.m="m",e.p="p",e.t="t",e.w="w",e.h="h",e.b="b"}(r||(t.Profession=r={})),t.ItemRankLabels=o,function(e){e.normal="normal",e.unique="unique",e.heroic="heroic",e.legendary="legendary"}(o||(t.ItemRankLabels=o={}))},284:()=>{},461:(e,t)=>{"use strict";function r(e){return Array.isArray(e)}function o(e){return"object"==typeof e&&!!e}Object.defineProperty(t,"__esModule",{value:!0}),t.isArray=r,t.isString=function(e){return"string"==typeof e},t.isNumber=function(e){return"number"==typeof e&&!Number.isNaN(e)},t.isObject=o,t.isCountable=function(e){return(o(e)||r(e))&&"number"==typeof e.length},t.isNumeric=function(e){return!Number.isNaN(Number(e))&&""!==e},t.toMap=function(e){return o(e)?new Map(Object.entries(e)):new Map},t.firstLetterToUpperCase=function(e){return e.charAt(0).toUpperCase()+e.substring(1)},t.toArray=function(e){return o(e)?Object.entries(e).map((([,e])=>e)):[]}},956:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getItemRankByStats=void 0;var o=r(355);t.getItemRankByStats=e=>{if("string"!=typeof e)throw new Error("item stats must be of type string");return e.match(";unique")||e.match("unique;")?o.ITEM_RANKS.UNIQUE:e.match(";heroic")||e.match("heroic;")?o.ITEM_RANKS.HEROIC:e.match(";legendary")||e.match("legendary;")?o.ITEM_RANKS.LEGENDARY:o.ITEM_RANKS.NORMAL}},810:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNpcRank=void 0;var o=r(355);t.getNpcRank=(e,t)=>4===e.type?o.NPC_RANKS.NORMAL:e.wt>99?5===(null==t?void 0:t.mode)?o.NPC_RANKS.COLOSSUS:o.NPC_RANKS.TITAN:e.wt>79?o.NPC_RANKS.HEROS:e.wt>29?o.NPC_RANKS.ELITE3:e.wt>19?o.NPC_RANKS.ELITE2:e.wt>9?o.NPC_RANKS.ELITE:o.NPC_RANKS.NORMAL},265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNpcsFromFightersMap=void 0,t.getNpcsFromFightersMap=e=>{const t=new Map;return e.forEach(((e,r)=>{e.npc&&t.set(r,e)})),t}},676:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(810);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=r(643);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var s=r(288);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var i=r(435);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var n=r(265);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))}));var l=r(956);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=r(198);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var u=r(780);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}))},198:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isItemGoodEnough=void 0;var o=r(355);t.isItemGoodEnough=e=>e.rank.type>=o.ITEM_RANKS.NORMAL.type},643:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNpcWorthCounting=void 0;var o=r(355);t.isNpcWorthCounting=e=>e.type>=o.NPC_RANKS.NORMAL.type},780:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapItems=void 0;var o=r(676);t.mapItems=e=>e.map((e=>({name:e.name,rank:(0,o.getItemRankByStats)(e.stat)})))},435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.searchForBosses=void 0;var o=r(456),a=r(676);t.searchForBosses=e=>{let t=[];return e.forEach(((e,r)=>{const s=Math.abs(r),i=(0,o.getNpcById)(s);if(console.log("GAME NPC",i),!i)return;const n=(0,a.getNpcRank)(i,(0,o.getGameMap)());if(console.log("GAME NPC RANK",n),!(0,a.isNpcWorthCounting)(n))return;const l={id:s,icon:i.icon,nick:i.nick,lvl:i.lvl,rank:n.type};t=[...t,l]})),t}},288:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wasPageRefreshDuringBattle=void 0,t.wasPageRefreshDuringBattle=e=>void 0!==e.f&&void 0!==e.matchmaking_state},645:(e,t,r)=>{"use strict";r.r(t)}},t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=r(318);r(645);var t=e(r(896)),o=r(355);new t.default(window).init(),console.log("COUNTER_VERSION",o.ADDON_VERSION)})()})();